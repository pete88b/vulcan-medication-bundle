---

title: Core


keywords: fastai
sidebar: home_sidebar

summary: "Handle FHIR server communication and low-level resource functions."
description: "Handle FHIR server communication and low-level resource functions."
nb_path: "00_core.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_as_raw_json" class="doc_header"><code>get_as_raw_json</code><a href="https://github.com/pete88b/vulcan_medication_bundle/tree/main/vulcan_medication_bundle/core.py#L16" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_as_raw_json</code>(<strong><code>api_base</code></strong>, <strong><code>resource_type</code></strong>, <strong><code>id_or_params</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>GET FHIR resources of <code>resource_type</code> in JSON format</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><code>api_base</code> a "real" API base like <code>http://hapi.fhir.org/baseR4</code> </li>
<li><code>resource_type</code> the type of resource to get. e.g. <code>Medication</code></li>
<li><code>url_suffix</code> the preferred way to add search criteria. e.g. <code>?subject=d28f9c95-8098-4794-b1d0-57e45faf2b39</code></li>
</ul>
<p>To search for some medications;</p>

<pre><code>get_as_raw_json('https://server.fire.ly/r4', 'Medication')</code></pre>
<p>To get a single medication;</p>

<pre><code>get_as_raw_json('https://server.fire.ly/r4', Medication', '?_id=d28f9c95-8098-4794-b1d0-57e45faf2b39')</code></pre>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_next_as_raw_json" class="doc_header"><code>get_next_as_raw_json</code><a href="https://github.com/pete88b/vulcan_medication_bundle/tree/main/vulcan_medication_bundle/core.py#L29" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_next_as_raw_json</code>(<strong><code>json_response</code></strong>)</p>
</blockquote>
<p>GET the next set of results</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="timestamp_now" class="doc_header"><code>timestamp_now</code><a href="https://github.com/pete88b/vulcan_medication_bundle/tree/main/vulcan_medication_bundle/core.py#L38" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>timestamp_now</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="new_bundle" class="doc_header"><code>new_bundle</code><a href="https://github.com/pete88b/vulcan_medication_bundle/tree/main/vulcan_medication_bundle/core.py#L42" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>new_bundle</code>(<strong><code>bundle_type</code></strong>=<em><code>'collection'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">new_bundle</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;{&#34;resourceType&#34;: &#34;Bundle&#34;, &#34;id&#34;: &#34;efd73f5b-1a76-44d1-a948-4a9add134921&#34;, &#34;type&#34;: &#34;collection&#34;, &#34;timestamp&#34;: &#34;2021-09-16T12:34:37Z&#34;, &#34;entry&#34;: []}&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="new_list" class="doc_header"><code>new_list</code><a href="https://github.com/pete88b/vulcan_medication_bundle/tree/main/vulcan_medication_bundle/core.py#L50" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>new_list</code>(<strong><code>title</code></strong>, <strong><code>status</code></strong>=<em><code>'current'</code></em>, <strong><code>mode</code></strong>=<em><code>'snapshot'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">new_list</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;test list&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;{&#34;resourceType&#34;: &#34;List&#34;, &#34;id&#34;: &#34;2b1c363a-47d6-40dc-99ff-7a6721a50a2a&#34;, &#34;title&#34;: &#34;test list&#34;, &#34;status&#34;: &#34;current&#34;, &#34;mode&#34;: &#34;snapshot&#34;, &#34;date&#34;: &#34;2021-09-16T12:34:37Z&#34;, &#34;entry&#34;: []}&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">api_base</span><span class="p">,</span> <span class="n">resource_type</span> <span class="o">=</span> <span class="s1">&#39;http://hapi.fhir.org/baseR4&#39;</span><span class="p">,</span> <span class="s1">&#39;ResearchStudy&#39;</span>
<span class="c1"># api_base, resource_type = &#39;https://r4.smarthealthit.org&#39;, &#39;MedicationRequest&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The following cell shows how <a href="/vulcan_medication_bundle/core.html#get_as_raw_json"><code>get_as_raw_json</code></a> and <a href="/vulcan_medication_bundle/core.html#get_next_as_raw_json"><code>get_next_as_raw_json</code></a> can be used to read paged search results.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bundle</span> <span class="o">=</span> <span class="n">get_as_raw_json</span><span class="p">(</span><span class="n">api_base</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)[:</span><span class="mi">500</span><span class="p">],</span> <span class="s1">&#39;...&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>GET http://hapi.fhir.org/baseR4/ResearchStudy?_format=json
{
  &#34;resourceType&#34;: &#34;Bundle&#34;,
  &#34;id&#34;: &#34;8b604b8c-a8f4-4243-9c39-09175c6cb28d&#34;,
  &#34;meta&#34;: {
    &#34;lastUpdated&#34;: &#34;2021-09-16T12:34:38.178+00:00&#34;
  },
  &#34;type&#34;: &#34;searchset&#34;,
  &#34;total&#34;: 57,
  &#34;link&#34;: [
    {
      &#34;relation&#34;: &#34;self&#34;,
      &#34;url&#34;: &#34;http://hapi.fhir.org/baseR4/ResearchStudy?_format=json&#34;
    },
    {
      &#34;relation&#34;: &#34;next&#34;,
      &#34;url&#34;: &#34;http://hapi.fhir.org/baseR4?_getpages=8b604b8c-a8f4-4243-9c39-09175c6cb28d&amp;_getpagesoffset=20&amp;_count=20&amp;_format=json&amp;_pretty=true&amp;_bundletype=searchs ...
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">json_response</span> <span class="o">=</span> <span class="n">get_as_raw_json</span><span class="p">(</span><span class="n">api_base</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">)</span>
<span class="n">page_count</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">while</span> <span class="n">json_response</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">json_response</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span> <span class="k">break</span> <span class="c1"># show just 3 resources per &quot;page&quot;</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;resource&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{resource_type}</span><span class="s1">:id&#39;</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;missing&#39;</span><span class="p">),</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)[:</span><span class="mi">60</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">page_count</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span> <span class="k">break</span> <span class="c1"># pull 3 pages at most to make testing fast</span>
    <span class="n">json_response</span> <span class="o">=</span> <span class="n">get_next_as_raw_json</span><span class="p">(</span><span class="n">json_response</span><span class="p">)</span>
    <span class="n">page_count</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>GET http://hapi.fhir.org/baseR4/ResearchStudy?_format=json
ResearchStudy:id 2492775 Double blind, placebo-controlled trial of a new class of art
ResearchStudy:id 1164317 Adjuvant Aspirin Treatment in PIK3CA Mutated Colon Cancer Pa
ResearchStudy:id 1164321 A Phase III, Multicenter, Randomized, Open-Label Study Compa
GET http://hapi.fhir.org/baseR4?_getpages=8b604b8c-a8f4-4243-9c39-09175c6cb28d&amp;_getpagesoffset=20&amp;_count=20&amp;_format=json&amp;_pretty=true&amp;_bundletype=searchset
ResearchStudy:id 2111275 Safety and Efficacy of the Xanomeline Transdermal Therapeuti
ResearchStudy:id 2111271 Safety and Efficacy of the Xanomeline Transdermal Therapeuti
ResearchStudy:id 2085795 Patientenbefragung Augenklinik
GET http://hapi.fhir.org/baseR4?_getpages=8b604b8c-a8f4-4243-9c39-09175c6cb28d&amp;_getpagesoffset=40&amp;_count=20&amp;_format=json&amp;_pretty=true&amp;_bundletype=searchset
ResearchStudy:id 248374 
ResearchStudy:id 247777 
ResearchStudy:id 247565 
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_references_from_resource" class="doc_header"><code>extract_references_from_resource</code><a href="https://github.com/pete88b/vulcan_medication_bundle/tree/main/vulcan_medication_bundle/core.py#L60" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_references_from_resource</code>(<strong><code>resource</code></strong>, <strong><code>field_name</code></strong>)</p>
</blockquote>
<p>Return a list of references extracted from a single resource and field</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>TODO: &uarr; we don't need to fetch contained references but we might want to make them bundle entries like the references that we do have to GET - check with Jay if this is already taken care of in FHIR to CDISC</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;test/patient_medication_bundle_0c4a1143-8d1c-42ed-b509-eac97d77c9b2.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">test_bundle</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">test_entry</span> <span class="o">=</span> <span class="n">test_bundle</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
<span class="n">test_resource</span> <span class="o">=</span> <span class="n">test_entry</span><span class="p">[</span><span class="s1">&#39;resource&#39;</span><span class="p">]</span> <span class="c1"># resource with medicationReference</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="p">([</span><span class="s1">&#39;Medication/bac1387e-3655-4e03-982f-7210faa21ea8&#39;</span><span class="p">]</span> 
        <span class="o">==</span> <span class="n">extract_references_from_resource</span><span class="p">(</span><span class="n">test_resource</span><span class="p">,</span> <span class="s1">&#39;medicationReference&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_references" class="doc_header"><code>extract_references</code><a href="https://github.com/pete88b/vulcan_medication_bundle/tree/main/vulcan_medication_bundle/core.py#L75" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_references</code>(<strong><code>bundle</code></strong>, <strong><code>field_names</code></strong>)</p>
</blockquote>
<p>Return a list of relative references e.g. <code>['Condition/1ddef4ad-fb76-46d6-9f1d-8ed58b173ee8']</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="p">([</span><span class="s1">&#39;Condition/1ddef4ad-fb76-46d6-9f1d-8ed58b173ee8&#39;</span><span class="p">,</span> <span class="s1">&#39;Medication/bac1387e-3655-4e03-982f-7210faa21ea8&#39;</span><span class="p">]</span>
        <span class="o">==</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">extract_references</span><span class="p">(</span><span class="n">test_bundle</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;medicationReference&#39;</span><span class="p">,</span> <span class="s1">&#39;reasonReference&#39;</span><span class="p">])))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_bundle</span> <span class="o">=</span> <span class="n">new_bundle</span><span class="p">()</span>
<span class="n">test_bundle</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">test_entry</span><span class="p">,</span> <span class="n">test_entry</span><span class="p">])</span> <span class="c1"># create a bundle with duplicate medication references</span>
<span class="k">assert</span> <span class="p">([</span><span class="s1">&#39;Medication/bac1387e-3655-4e03-982f-7210faa21ea8&#39;</span><span class="p">]</span>
        <span class="o">==</span> <span class="n">extract_references</span><span class="p">(</span><span class="n">test_bundle</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;medicationReference&#39;</span><span class="p">,</span> <span class="s1">&#39;reasonReference&#39;</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>TODO: We need some config around how many and what type of issues clients can accept</p>
<ul>
<li>some might want to fail if any piece of info cannot be found - i.e. references can't be followed</li>
<li>some might want to get whatever is available and deal with the inconsistencies</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_by_reference" class="doc_header"><code>get_by_reference</code><a href="https://github.com/pete88b/vulcan_medication_bundle/tree/main/vulcan_medication_bundle/core.py#L86" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_by_reference</code>(<strong><code>api_base</code></strong>, <strong><code>reference</code></strong>)</p>
</blockquote>
<p>Return a resource read from a FHIR server by reference, as a list containg a single bundle entry</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If a resource has a reference like</p>

<pre><code>'medicationReference': {'reference': 'Medication/bac1387e-3655-4e03-982f-7210faa21ea8'},</code></pre>
<p>we can HTTP GET the referenced resource (a <code>Medication</code> in this case) with <a href="http://hapi.fhir.org/baseR4/Medication/bac1387e-3655-4e03-982f-7210faa21ea8">http://hapi.fhir.org/baseR4/Medication/bac1387e-3655-4e03-982f-7210faa21ea8</a> - then wrap it up as a FHIR <code>Entry</code></p>
<p>No problem if the reference includes the API base. This &darr; works the same as &uarr;</p>

<pre><code>'medicationReference': {'reference': 'http://hapi.fhir.org/baseR4/Medication/bac1387e-3655-4e03-982f-7210faa21ea8'},</code></pre>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">api_base</span> <span class="o">==</span> <span class="s1">&#39;http://hapi.fhir.org/baseR4&#39;</span><span class="p">:</span>
    <span class="n">test_id</span> <span class="o">=</span> <span class="s1">&#39;bac1387e-3655-4e03-982f-7210faa21ea8&#39;</span>
    <span class="k">assert</span> <span class="n">get_by_reference</span><span class="p">(</span><span class="n">api_base</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;Medication/</span><span class="si">{test_id}</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;resource&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">test_id</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>GET http://hapi.fhir.org/baseR4/Medication/bac1387e-3655-4e03-982f-7210faa21ea8?_format=json
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Bundle-filtering">Bundle filtering<a class="anchor-link" href="#Bundle-filtering"> </a></h2><p>We need to be able to remove (filter out) entries from the bundle</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="filter_bundle" class="doc_header"><code>filter_bundle</code><a href="https://github.com/pete88b/vulcan_medication_bundle/tree/main/vulcan_medication_bundle/core.py#L98" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>filter_bundle</code>(<strong><code>bundle</code></strong>, <strong><code>filter_fn</code></strong>)</p>
</blockquote>
<p>Apply a filter function to a bundle in-place</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

