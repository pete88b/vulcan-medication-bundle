---

title: Core


keywords: fastai
sidebar: home_sidebar

summary: "Handle FHIR server communication and low-level resource functions."
description: "Handle FHIR server communication and low-level resource functions."
nb_path: "00_core.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_bundle_as_raw_json" class="doc_header"><code>get_bundle_as_raw_json</code><a href="https://github.com/pete88b/vulcan_medication_bundle/tree/main/vulcan_medication_bundle/core.py#L11" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_bundle_as_raw_json</code>(<strong><code>api_base</code></strong>, <strong><code>resource_type</code></strong>, <strong><code>url_suffix</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>GET a bundle of resources of a specific type</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_next_bundle_as_raw_json" class="doc_header"><code>get_next_bundle_as_raw_json</code><a href="https://github.com/pete88b/vulcan_medication_bundle/tree/main/vulcan_medication_bundle/core.py#L20" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_next_bundle_as_raw_json</code>(<strong><code>json_response</code></strong>)</p>
</blockquote>
<p>GET the next set of results</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="timestamp_now" class="doc_header"><code>timestamp_now</code><a href="https://github.com/pete88b/vulcan_medication_bundle/tree/main/vulcan_medication_bundle/core.py#L28" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>timestamp_now</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="new_bundle" class="doc_header"><code>new_bundle</code><a href="https://github.com/pete88b/vulcan_medication_bundle/tree/main/vulcan_medication_bundle/core.py#L32" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>new_bundle</code>(<strong><code>bundle_type</code></strong>=<em><code>'collection'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">new_bundle</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;{&#34;resourceType&#34;: &#34;Bundle&#34;, &#34;type&#34;: &#34;collection&#34;, &#34;timestamp&#34;: &#34;2021-09-10T09:41:59Z&#34;, &#34;entry&#34;: []}&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">api_base</span> <span class="o">=</span> <span class="s1">&#39;http://hapi.fhir.org/baseR4&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The following cell shows how <a href="/vulcan_medication_bundle/core.html#get_bundle_as_raw_json"><code>get_bundle_as_raw_json</code></a> and <a href="/vulcan_medication_bundle/core.html#get_next_bundle_as_raw_json"><code>get_next_bundle_as_raw_json</code></a> can be used to read paged search results.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">json_response</span> <span class="o">=</span> <span class="n">get_bundle_as_raw_json</span><span class="p">(</span><span class="n">api_base</span><span class="p">,</span> <span class="s1">&#39;ResearchStudy&#39;</span><span class="p">)</span>
<span class="n">page_count</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">while</span> <span class="n">json_response</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>    
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">json_response</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">]:</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;resource&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ResearchStudy:id&#39;</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;missing&#39;</span><span class="p">),</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)[:</span><span class="mi">60</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">page_count</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span> <span class="k">break</span> <span class="c1"># pull 3 pages at most to make testing fast</span>
    <span class="n">json_response</span> <span class="o">=</span> <span class="n">get_next_bundle_as_raw_json</span><span class="p">(</span><span class="n">json_response</span><span class="p">)</span>
    <span class="n">page_count</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>GET http://hapi.fhir.org/baseR4/ResearchStudy
ResearchStudy:id 2492775 Double blind, placebo-controlled trial of a new class of art
ResearchStudy:id 1164317 Adjuvant Aspirin Treatment in PIK3CA Mutated Colon Cancer Pa
ResearchStudy:id 1164321 A Phase III, Multicenter, Randomized, Open-Label Study Compa
ResearchStudy:id 2140627 
ResearchStudy:id 2126241 Projectathon 2021 Machbarkeitsanfrage
ResearchStudy:id 2126240 Projectathon 2021 Machbarkeitsanfrage
ResearchStudy:id 2114074 Safety and Efficacy of the Xanomeline Transdermal Therapeuti
ResearchStudy:id 2114070 Safety and Efficacy of the Xanomeline Transdermal Therapeuti
ResearchStudy:id 2111327 Safety and Efficacy of the Xanomeline Transdermal Therapeuti
ResearchStudy:id 2111323 Safety and Efficacy of the Xanomeline Transdermal Therapeuti
ResearchStudy:id 2111319 Safety and Efficacy of the Xanomeline Transdermal Therapeuti
ResearchStudy:id 2111315 Safety and Efficacy of the Xanomeline Transdermal Therapeuti
ResearchStudy:id 2111311 Safety and Efficacy of the Xanomeline Transdermal Therapeuti
ResearchStudy:id 2111307 Safety and Efficacy of the Xanomeline Transdermal Therapeuti
ResearchStudy:id 2111303 Safety and Efficacy of the Xanomeline Transdermal Therapeuti
ResearchStudy:id 2111299 Safety and Efficacy of the Xanomeline Transdermal Therapeuti
ResearchStudy:id 2111295 Safety and Efficacy of the Xanomeline Transdermal Therapeuti
ResearchStudy:id 2111291 Safety and Efficacy of the Xanomeline Transdermal Therapeuti
ResearchStudy:id 2111287 Safety and Efficacy of the Xanomeline Transdermal Therapeuti
ResearchStudy:id 2111283 Safety and Efficacy of the Xanomeline Transdermal Therapeuti
GET http://hapi.fhir.org/baseR4?_getpages=ee8d34fd-948c-4ca6-93d2-532ee1cb1214&amp;_getpagesoffset=20&amp;_count=20&amp;_pretty=true&amp;_bundletype=searchset
ResearchStudy:id 2111275 Safety and Efficacy of the Xanomeline Transdermal Therapeuti
ResearchStudy:id 2111271 Safety and Efficacy of the Xanomeline Transdermal Therapeuti
ResearchStudy:id 2085795 Patientenbefragung Augenklinik
ResearchStudy:id 2085789 Austrittsbereitschaft Medizin
ResearchStudy:id 2085775 Austrittsbereitschaft Chirurgie
ResearchStudy:id 1737628 Safety and Efficacy of the Xanomeline Transdermal Therapeuti
ResearchStudy:id 1171831 Simple Covid-19 observational study
ResearchStudy:id 1164323 A Phase IIb Study of RAMucirumab in Combination With TAS102 
ResearchStudy:id 1164315 MONARCH 2: A Randomized, Double-Blind, Placebo-Controlled, P
ResearchStudy:id 1164319 Durvalumab (MEDI4736) in Frail and Elder Patients With Metas
ResearchStudy:id 1093619 Testkohorte Diabetes
ResearchStudy:id 697836 
ResearchStudy:id 697838 
ResearchStudy:id 642249 Klinische Studie über einen Zeitraum von mindestens 6 Monate
ResearchStudy:id sirb-dl-ex-study-mmr Longitudinal study of MMR vaccination in patients born from 
ResearchStudy:id 592095 Eine prospektive, multizentrische, randomisierte, offene, ak
ResearchStudy:id 588461 A Study to Evaluate the Pharmacokinetics, Safety, Tolerabili
ResearchStudy:id 443581 A Study Of Negative Reinforcement on Foot-Tapping
ResearchStudy:id 246543 test1
ResearchStudy:id 248531 
GET http://hapi.fhir.org/baseR4?_getpages=ee8d34fd-948c-4ca6-93d2-532ee1cb1214&amp;_getpagesoffset=40&amp;_count=20&amp;_pretty=true&amp;_bundletype=searchset
ResearchStudy:id 248374 
ResearchStudy:id 247777 
ResearchStudy:id 247565 
ResearchStudy:id 246779 
ResearchStudy:id 246280 
ResearchStudy:id 246125 
ResearchStudy:id 245854 
ResearchStudy:id 245605 
ResearchStudy:id 245534 
ResearchStudy:id 245463 
ResearchStudy:id 245393 
ResearchStudy:id 245342 
ResearchStudy:id sirb-dl-ex-study-ph2 Longitudinal study of MMR vaccination in patients born from 
ResearchStudy:id 71530 Lollipop 1 Study
ResearchStudy:id 48866 Das rechte Herz in der Schwangerschaft. Echokardiographische
ResearchStudy:id 38364 Longitudinal study of MMR vaccination in patients born from 
ResearchStudy:id 1616 PAH Nice 1.1 later than 2016
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_references_from_resource" class="doc_header"><code>extract_references_from_resource</code><a href="https://github.com/pete88b/vulcan_medication_bundle/tree/main/vulcan_medication_bundle/core.py#L39" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_references_from_resource</code>(<strong><code>resource</code></strong>, <strong><code>field_name</code></strong>)</p>
</blockquote>
<p>Return a list of references extracted from a single resource and field</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;test/patient_medication_bundle_0c4a1143-8d1c-42ed-b509-eac97d77c9b2.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">test_bundle</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">test_entry</span> <span class="o">=</span> <span class="n">test_bundle</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
<span class="n">test_resource</span> <span class="o">=</span> <span class="n">test_entry</span><span class="p">[</span><span class="s1">&#39;resource&#39;</span><span class="p">]</span> <span class="c1"># resource with medicationReference</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="p">([</span><span class="s1">&#39;Medication/bac1387e-3655-4e03-982f-7210faa21ea8&#39;</span><span class="p">]</span> 
        <span class="o">==</span> <span class="n">extract_references_from_resource</span><span class="p">(</span><span class="n">test_resource</span><span class="p">,</span> <span class="s1">&#39;medicationReference&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_references" class="doc_header"><code>extract_references</code><a href="https://github.com/pete88b/vulcan_medication_bundle/tree/main/vulcan_medication_bundle/core.py#L52" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_references</code>(<strong><code>bundle</code></strong>, <strong><code>field_names</code></strong>)</p>
</blockquote>
<p>Return a list of relative references e.g. <code>['Condition/1ddef4ad-fb76-46d6-9f1d-8ed58b173ee8']</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="p">([</span><span class="s1">&#39;Condition/1ddef4ad-fb76-46d6-9f1d-8ed58b173ee8&#39;</span><span class="p">,</span> <span class="s1">&#39;Medication/bac1387e-3655-4e03-982f-7210faa21ea8&#39;</span><span class="p">]</span>
        <span class="o">==</span> <span class="n">extract_references</span><span class="p">(</span><span class="n">test_bundle</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;medicationReference&#39;</span><span class="p">,</span> <span class="s1">&#39;reasonReference&#39;</span><span class="p">]))</span>
<span class="c1"># show that references are de-duplicated</span>
<span class="n">test_bundle</span> <span class="o">=</span> <span class="n">new_bundle</span><span class="p">()</span>
<span class="n">test_bundle</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">test_entry</span><span class="p">,</span> <span class="n">test_entry</span><span class="p">])</span> <span class="c1"># create a bundle with duplicate medication references</span>
<span class="k">assert</span> <span class="p">([</span><span class="s1">&#39;Medication/bac1387e-3655-4e03-982f-7210faa21ea8&#39;</span><span class="p">]</span>
        <span class="o">==</span> <span class="n">extract_references</span><span class="p">(</span><span class="n">test_bundle</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;medicationReference&#39;</span><span class="p">,</span> <span class="s1">&#39;reasonReference&#39;</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_by_reference" class="doc_header"><code>get_by_reference</code><a href="https://github.com/pete88b/vulcan_medication_bundle/tree/main/vulcan_medication_bundle/core.py#L62" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_by_reference</code>(<strong><code>api_base</code></strong>, <strong><code>reference</code></strong>)</p>
</blockquote>
<p>Return a resource read from a FHIR server by reference, as a list containg a single bundle entry</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If a resource has a reference like</p>

<pre><code>'medicationReference': {'reference': 'Medication/bac1387e-3655-4e03-982f-7210faa21ea8'},</code></pre>
<p>we can HTTP GET the referenced resource (a <code>Medication</code> in this case) with <a href="http://hapi.fhir.org/baseR4/Medication?_id=bac1387e-3655-4e03-982f-7210faa21ea8">http://hapi.fhir.org/baseR4/Medication?_id=bac1387e-3655-4e03-982f-7210faa21ea8</a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_id</span> <span class="o">=</span> <span class="s1">&#39;bac1387e-3655-4e03-982f-7210faa21ea8&#39;</span>
<span class="k">assert</span> <span class="n">get_by_reference</span><span class="p">(</span><span class="n">api_base</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;Medication/</span><span class="si">{test_id}</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;resource&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">test_id</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>GET http://hapi.fhir.org/baseR4/Medication?_id=bac1387e-3655-4e03-982f-7210faa21ea8
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

